# Computer Network

## 7 网络安全

**四种威胁**

- 截获：从网络上窃听他人的通信内容
- 中断：有意中断他人在网络上的通信
- 篡改：故意篡改网络上传送的报文
- 伪造：伪造信息在网络上传送

**被动攻击与主动攻击**

- 在被动攻击中，攻击者只是观察和分析某一个协议数据单元PDU而不干扰信息流
- 主动攻击是指攻击者对某个连接中通过的PDU（Protocol Data Unit）进行各种处理：更改报文流；拒绝报文服务；伪造连接初始化

**计算机网络通信安全的目标**

- 防止析出报文内容
- 防止通信量分析
- 检测更改报文流
- 检测拒绝报文服务
- 检测伪造初始化连接

### 7.1 两类密码体制

**对称密钥密码体制**

- 所谓常规密钥密码体制，即加密密钥与解密密钥是相同的密码体制
- 这种加密系统又称为对称密钥系统

**公钥密码体制**

- 使用不同的加密密钥与解密密钥，是一种“由已知加密密钥推导出解密密钥在计算上是不可行的”密码体制
- 公钥密码体制的产生主要是因为两个方面的原因，意识由于常规密钥密码体制的密钥分配问题，另一是由于对数字签名的需求
- 现有最著名的公钥密码体制是RSA体制：基于数论中大数分解的体制

**公钥算法的特点**：

- 发送者A用B的 Public Key （PKB）对明文 X 进行 Encrypt 后，在接收者 B 用自己的私钥 Special Key（SKB）进行 Deciphering，即可恢复出明文：

```Shell
DskB(Y) = DskB(EpkB(X)) = X
```

- 解密密钥是接收者专用的密钥，对其他人都保密
- PK 是公开的，但不能用它来解密，即：

```Shell
DpkB(EpkB(X)) != X
```

- 加密和解密的运算可以对调，即：

```Shell
EpkB(DskB(X)) = DskB(EpkB(X)) = X
```

- 在计算机上可容易地产生成对的 PK 和 SK
- 从已知的 PK 实际上不可能推导出 SK （计算不可能）
- 加密和解密算法都是公开的

### 7.2 数字签名

- 发送者事后不能抵赖对报文的签名
- 接收者不能伪造对报文的签名

**数字签名的实现**

```Shell
A ----------------------------------- B  
X -------> DskA =======> EpkA ------> X

X -> DskA -> EpkB ==> DpkA -> EskB -> B
```

**报文摘要**（Message Digest）

- 对于很长的报文进行Decipher 或 Encrypt 运算是极端耗时的
- 因此散列函数就可以进行将长报文映射成短摘要的形式
- 再对报文摘要进行加密运算等就节省了资源

**中间人攻击**（邮局攻击）

- 通信两方的所有信件都通过中间人，中间人如果也能分配密钥的话，那么所有的通信都暴露在中间人的眼中
- 避免中间人攻击的关键在于，密钥分配的环节

### 7.3 密钥分配

- 密钥分配必须通过最安全的通路进行分配
- 目前常用的密钥分配方式是设立密钥分配中心 KDC（Key Distribution）分发对称密钥

**公钥的分配**

- 需要有一个值得信赖的机构-即认证中心 CA（Certification Authority），来将公钥与其对应的实体（人或机器）进行绑定（binding）
- 认证中心一般由政府出资建立，每个实体都有CA发来的证书（certificate），里面有公钥及其拥有者的标识信息。此证书被CA进行了数字签名，任何用户都可以从可信的地方来获得认证中心CA的公钥，此公钥用来验证某个公钥是否为某个实体所拥有。有的大公司也提供认证中心服务

**网络攻击手段**

- 末日帝国DDOS攻击器（Distributed Denial Of Service）
- 分布式攻击，控制众多 Clients 访问 Server 建立大量TCP连接，占用 Server 资源
- 通过木马程序（灰鸽子 Grey Pigeon）控制主机
- 通过 netstat 命令排查木马病毒

### 7.4 因特网使用的安全协议

#### 网络层安全协议

- 1 IPsec 与安全关联 SA：网络层保密是指所有在 IP 数据报中的数据都是加密的

**IPsec 中最主要的两个部分**

- 鉴别首部 AH（Authentication Header）: AH鉴别源点和检查数据完整性，但不能保密
- 封装安全有效载荷 ESP（Encapsulation Security Payload）：ESP 比 AH 复杂得多，它鉴别源点，检查数据完整性和提供保密

**安全关联SA**（Security Association）

- 在使用 AH 或 ESP 之前，先要从源主机到目的主机建立一条网络层的逻辑连接，此逻辑连接叫做安全关联 SA
- IPsec 就把传统的因特网无连接的网络层转换为具有逻辑连接的层

**安全关联的特点**

AH只做身份鉴别但不加密，依然是 ASCII 码明文传输，ESP 既做身份鉴别又做加密，ASCII码密文传输
安全关联是一个单向连接。它由一个三元组唯一地确定，包括：

- 安全协议（使用 AH 或 ESP）的标识符
- 此单向连接的源 IP 地址
- 一个 32 位的连接标识符，称为安全参数索引 SPI （Security Parameter Index）

对于一个给定的安全关联 SA，每一个IPsec数据报都有一个存放SPI的字段。通过此SA的所有数据报都使用同样的SPI值

**鉴别首部协议AH**（Security Association）

- 在使用鉴别首部协议AH时，把AH首部插在元数据数据部分的前面，同时把IP首部中的协议字段设置为51
- 在传输过程中，中间的路由器都不查看AH的首部。当数据报达到终点时，目的主机才处理AH字段，以鉴别源点和检测数据报的完整性

```shell
| IP首部（协议号 = 51）| AH首部 | ICP/UDP报文段 |
```

**封装安全有效荷载** ESP（Encapsulation Security Payload）

```Shell
| IP首部（协议号 = 50）| ESP首部 | TCP/UDP 报文段 | ESP尾部 | ESP鉴别 |
```

#### 传输层安全协议

**安全套接层 SSL(Secure Socket Layer)**

- SSL在双方的联络阶段协商使用的加密算法和密钥，以及客户与服务器之间的鉴别
- 在联络阶段完成之后，所有传送的数据都使用在联络阶段商定的会话密钥（此时应用对称加密算法）
- SSL不仅被所有常用的浏览器和万维网服务器所支持，而且也是运输层安全协议TLS（Transport Layer Security）的基础

```Shell
应用层
SSL
传输层 TCP
```

在发送方，SSL接收应用层的数据（如 HTTP 或 IMAP 报文），对数据进行加密，然后把加了密的数据送往TCP套接字；在接收方，SSL从TCP套接字读取数据，解密后把数据交给应用层。

**SSL提供三个功能**

- SSL服务器鉴别： 允许用户证实服务器身份。具有SSL功能的浏览器维持一个表，上面有一些可以信赖的认证中心CA（Certificate Authority）和它们的公钥。
- 加密的SSL会话： 客户和服务器交互的所有数据都在发送方加密，在接收方解密
- SSL客户鉴别： 允许服务器证实客户的身份

#### 防火墙

- 是一种特殊编程的路由器：拥有“允许”和“阻止”的功能
