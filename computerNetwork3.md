# Computer Network

## 3 数据链路层

数据链路层使用的信道主要有以下两种类：

- 点对点信道：这种信道使用一对一的点对点通信方式。

- 广播信道：这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送

### 3.1 使用点对点信道的数据链路层

#### 3.1.1 数据链路和帧

**链路(link)** 是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。

- 一条链路只是一条通路的一个组成部分。

**数据链路(data link)** 除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

- 现在最常用的方法是使用适配器（即网卡）来实现这些协议的硬件和软件。

- 一般的适配器都包括了数据链路层和物理层这两层的功能。   

#### 3.1.2 三个基本问题

- 封装成帧

- 透明传输

- 差错控制

**PPP协议**：点对点协议（Point to Point Protocol）用户使用拨号电话线接入因特网时，一般都是使用PPP协议

**PPP协议满足的要求**：

- 简单

- 封装成帧

- 透明性

- 多种网络层协议

- 多种类型链路

- 差错检测

- 检测连接状态

- 最大传送单元

- 网络层地址协商

- 数据压缩协商

**PPP协议不需要满足的要求**：

- 纠错

- 流量控制

- 序号

- 多点线路

- 半双工或单工链路

**PPP协议的组成**：

- 数据链路层协议可以用于异步串行或同步串行介质

- 它使用LCP（Link control protocol）建立并维护数据链路连接（身份验证和计费功能）

- NCP（Network control protocol）允许在点到点连接上使用多种网络层协议

**PPP协议帧格式**：

- `7E + FF + 03 + 协议 + 信息部分（不超过1500字节） + FCS + 7E`

| 协议字段 | 含义                          |
| -------- | ----------------------------- |
| 0x0021   | ppp协议的信息字段就是IP数据报 |
| 0xC021   | 信息字段就是ppp链路控制数据   |
| 0x8021   | 表示这是网络控制数据          |
| 0xC023   | 信息字段是安全性认证PAP       |
| 0xC025   | 信息字段是LQR                 |
| 0xC223   | 信息字段是安全性认证CHAP      |

### 3.2 使用广播信道的数据链路层

#### 3.2.1 共享通信媒体

静态划分信道方法（麻烦）：

- 频分复用

- 时分复用

- 波分复用

- 码分复用

动态媒体接入控制（多点接入）：

- 随机接入 （主要被以太网采用）
  - 主机A将发给B的数据广播出去，B接受，其他主机不理会（安全性差）

- 受控接入 （polling 已经不被采用 ）

载波监听多点接入/碰撞检测 以太网使用CSMA/CD协议：

`CSMA/CD`表示 Carrier Sense Multiple Access with Collision

- “多点接入”：表示许多计算机以多点接入的方式连接在一根总线上

- “载波监听”：是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞，所谓载波监听，就是用电子技术检测总线上有没有其他计算机发送的数据信号

**碰撞检测**：就是计算机发送数据边检测信道上的信号电压大小

- 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）

- 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞

- 所谓“碰撞”就是发生了冲突，因此“碰撞检测”也称为“冲突检测”

**检测到碰撞后**

- 在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息

- 每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后等待一段随机时间后再次发送
