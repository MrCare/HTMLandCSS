# JavaScript

## 2 在HTML中使用JavaScript

- 使用`<script>`元素

- 嵌入脚本与外部脚本

- 文档模式对 JavaScript 的影响

- 考虑禁用 JavaScript 的场景

### 2.1 `<Script>`元素

HTML5（HTML CSS JS）为`<script>`定义了6个属性：

| 属性                      | 意义                                                              |
| ----------------------- | --------------------------------------------------------------- |
| **async**（asynchronous） | 可选：表示应该立即下载脚本，但不应妨碍页面中的其他操作，比如下载其他资源或等待加载其他脚本。只对外部脚本文件有效        |
| charset                 | 可选：表示通过 src 属性指定的代码的字符集。大多数浏览器会忽略此值，故这个属性很少被用到                  |
| **defer**               | 可选：表示脚本可以延迟到文档完全被解析和显示之后再执行。只对外部脚本文件有效                          |
| language                | 已废弃                                                             |
| src                     | 可选：表示包含要执行代码的外部文件                                               |
| type                    | 必选，如果忽略不写，默认值是`text/javascript`：表示编写代码使用的脚本语言的内容类型（也称为 MIME 类型） |

**注意：**

- 按照惯例，外部文件带有`.js`扩展名。但是这个扩展名不是必需的，因为浏览器不会检查包含 JavaScript 的文件扩展名。这样一来，使用 JSP，PHP或其他服务器端语言动态生成 JavaScript代码也就成了可能。但是，服务器通常还是需要看扩展名决定为响应应用哪种MIME类型，如果不使用`.js`扩展名，请确保服务器能返回正确的MIME类型。

- 外部域的JS代码也会被加载和解析

#### 2.1.1 标签的位置

- 按照传统的做法，所有`<script>`元素都应该放在页面的`<head>`元素中，然而除非用`window`对象的`onload`事件控制，否则代码会按照顺序在页面解析之前被下载，会影响用户体验

- 解决方案：

```javascript
window.onload = function() {
    //code
}
```

- 现代 Web 应用程序一般都把全部 JavaScript 引用放在`<body>`元素中页面的后面

#### 2.1.2 延迟脚本

```html
<script defer="defer" src="example1.js"></script>
<script defer="defer" src="example2.js"></script>
```

- defer 属性的用途是表明脚本在执行时不会影响页面的构造，脚本会被延迟到整个页面都解析完毕后再运行，设置该元素意味着告诉浏览器立即下载，但是延迟执行。

- HTML5规范中要求延迟脚本按出现顺序执行，然而实际上，脚本不一定能按出现顺序执行，因此最好只包含一个延迟脚本

- 把延迟脚本放在页面底部仍是最佳的选择

#### 2.1.3 异步脚本

- async属性与defer类似，async只适用于外部脚本文件，并告诉浏览器立即下载文件。但与defer不同的是，标记为async的脚本并不保证按照指定它们的先后顺序执行

### 2.2 嵌入代码与外部文件

最好的做法是尽可能使用外部文件来包含JavaScript代码，不过并不存在必须使用外部文件的硬性规定，但支持使用外部文件的人会强调如下优点：

1. 可维护性：遍及不同HTML页面的JS会造成维护问题，但把所有JS文件都放在一个文件夹中，维护起来就轻松多了。而且开发人员因此也能够在不触及HTML标记的情况下，集中精力编辑JS代码

2. 可缓存：浏览器能够具体的设置缓存联机的所有外部JS文件，如果两个页面都使用同一个文件，那么这个文件只需下载一次。因此，最终会加快页面加载速度。

3. 适应未来

### 2.3 文档模式

标准模式：

```html
<!DOCTYPE html>
```

### 2.4 `<noscript>`元素

早期浏览器都面临一个特殊问题，即当浏览器不支持 JavaScript 时，如何让页面平稳地退化。对这个问题的最终解决方案是创造一个`<noscript>`元素，用以在不支持 JavaScript 的浏览器中显示替代的内容。这个元素可以包含能够出现在文档`<body>`中的任何HTML元素，`<script>`元素除外，包含在`<noscript>`元素中的内容只有在下列情况下才会显示出来：

1. 浏览器不支持脚本

2. 浏览器支持脚本，但脚本被禁用

```html
<html>
  <head>
    <title>Example HTML Page</title>
    <script type="text/javascript" defer="defer" src="example1.js">
  </head>
  <body>
    <noscript>
        <p>本页面需要浏览器支持（启用）JavaScript</p>
    </noscript>
  </body>
</html>
```

这个页面会在脚本无效的时候向用户显示一条信息，如果脚本有效则不会显示，尽管它是页面的一部分


